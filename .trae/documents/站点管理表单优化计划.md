## 站点管理表单优化计划

### 问题分析
1. **前后端字段命名不一致**：前端使用驼峰命名（如`crawlerHeaders`），后端使用下划线命名（如`crawler_headers`），导致数据转换错误
2. **二次编辑表单回填问题**：当前表单在二次点击编辑时，部分字段没有正确回填
3. **数据保存到Redis问题**：需要确保配置数据正确保存到Redis

### 解决方案

#### 1. 统一前后端字段命名

**关键问题**：前端表单字段使用驼峰命名，后端配置结构体使用下划线命名

**解决方案**：
- 前端提交数据时，确保所有字段名转换为后端JSON标签定义的下划线命名
- 后端返回数据时，通过JSON标签自动转换为下划线命名

**具体修改点**：

| 表单类型 | 前端文件 | 后端文件 | 主要字段 |
|---------|---------|---------|---------|
| 编辑表单 | /web/src/pages/Sites/Sites.tsx | /internal/config/config.go | `firewall.action.defaultAction` → `firewall.action.default_action` |
| 渲染预热表单 | /web/src/pages/Sites/Sites.tsx | /internal/config/config.go | `crawlerHeaders` → `crawler_headers` |
| 推送配置表单 | /web/src/pages/Sites/Sites.tsx | /internal/config/config.go | `baiduDailyLimit` → `baidu_daily_limit` |

#### 2. 优化表单回填逻辑

**关键问题**：二次点击编辑时，部分字段没有正确回填到表单中

**解决方案**：
- 确保编辑表单回填时，所有字段正确转换并设置到表单中
- 修复渲染预热表单和推送配置表单的回填问题
- 统一表单数据处理逻辑

**具体修改点**：

1. **编辑表单回填**（`showModal`函数）：
   - 确保所有嵌套字段（如`firewall.geoip.allowList`）正确回填
   - 处理端口号转换为字符串类型的问题

2. **渲染预热表单回填**（`handlePrerenderConfig`函数）：
   - 确保所有字段正确设置到表单中，包括嵌套字段
   - 修复`crawlerHeaders`字段的处理逻辑

3. **推送配置表单回填**（`handlePushConfig`函数）：
   - 确保所有字段正确设置到表单中，包括嵌套字段
   - 修复`baiduDailyLimit`和`bingDailyLimit`字段的处理逻辑

#### 3. 确保数据正确保存到Redis

**关键问题**：站点配置更新时，相关数据需要同步更新到Redis

**解决方案**：
- 检查后端代码中Redis数据保存逻辑
- 确保站点配置更新时，相关数据也同步更新到Redis

**具体修改点**：

- 在`sites_controller.go`的`UpdateSite`方法中，添加保存配置到Redis的逻辑
- 确保渲染预热和推送配置更新时，Redis中的相关数据也同步更新

### 实施步骤

1. **修改前端编辑表单提交逻辑**
   - 文件：`/web/src/pages/Sites/Sites.tsx`
   - 函数：`handleSubmit`
   - 修改内容：统一将表单字段转换为后端所需的下划线命名

2. **修改前端渲染预热表单提交逻辑**
   - 文件：`/web/src/pages/Sites/Sites.tsx`
   - 函数：`handlePrerenderConfigSubmit`
   - 修改内容：统一将表单字段转换为后端所需的下划线命名

3. **修改前端推送配置表单提交逻辑**
   - 文件：`/web/src/pages/Sites/Sites.tsx`
   - 函数：`handlePushConfigSubmit`
   - 修改内容：统一将表单字段转换为后端所需的下划线命名

4. **优化编辑表单回填逻辑**
   - 文件：`/web/src/pages/Sites/Sites.tsx`
   - 函数：`showModal`
   - 修改内容：确保所有字段正确回填，包括嵌套字段

5. **优化渲染预热表单回填逻辑**
   - 文件：`/web/src/pages/Sites/Sites.tsx`
   - 函数：`handlePrerenderConfig`
   - 修改内容：确保所有字段正确回填，包括嵌套字段

6. **优化推送配置表单回填逻辑**
   - 文件：`/web/src/pages/Sites/Sites.tsx`
   - 函数：`handlePushConfig`
   - 修改内容：确保所有字段正确回填，包括嵌套字段

7. **检查后端Redis保存逻辑**
   - 文件：`/internal/api/controllers/sites_controller.go`
   - 函数：`UpdateSite`
   - 修改内容：添加保存配置到Redis的逻辑

### 预期结果
- 三个表单的前后端字段命名统一
- 二次点击编辑时，所有表单字段正确回填
- 表单数据能正确保存到Redis
- 现有功能不受影响

### 测试验证

1. **编辑表单测试**
   - 创建一个新站点，填写所有字段
   - 保存后，再次点击编辑，检查所有字段是否正确回填
   - 修改字段后，再次保存，检查数据是否正确更新

2. **渲染预热表单测试**
   - 打开渲染预热配置表单，填写所有字段
   - 保存后，再次打开，检查所有字段是否正确回填
   - 修改字段后，再次保存，检查数据是否正确更新

3. **推送配置表单测试**
   - 打开推送配置表单，填写所有字段
   - 保存后，再次打开，检查所有字段是否正确回填
   - 修改字段后，再次保存，检查数据是否正确更新

4. **Redis数据验证**
   - 保存配置后，检查Redis中是否保存了相关数据
   - 修改配置后，检查Redis中的数据是否同步更新